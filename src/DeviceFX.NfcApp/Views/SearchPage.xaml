<?xml version="1.0" encoding="utf-8"?>

<shared:StepContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                        xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                        xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                        xmlns:shared="clr-namespace:DeviceFX.NfcApp.Views.Shared"
                        xmlns:converters="clr-namespace:DeviceFX.NfcApp.Helpers.Converters"
                        Priority="20"
                        Group="Provision"
                        Title="Search"
                        HideSoftInputOnTapped="True"
                        x:Name="This"
                        x:Class="DeviceFX.NfcApp.Views.SearchPage">
    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary x:Key="SelectionImageMapper">
                <x:String x:Key="User">customer.png</x:String>
                <x:String x:Key="Workspace">workspace.png</x:String>
            </ResourceDictionary>            
            <converters:StringMapperConverter x:Key="SelectionImageConverter"/>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <Grid Padding="15" RowDefinitions="Auto, Auto, *, 50">
            <Label Text="User/Workspace to assign" FontSize="20" VerticalOptions="Center"/>
            <StackLayout Grid.Row="1">
                <SearchBar x:Name="searchBar"
                           Text="{Binding SearchInput}"
                           BackgroundColor="White"
                           Placeholder="Search name/extension" 
                           SearchCommandParameter="{Binding SearchInput}"
                           SearchCommand="{Binding SearchCommand}" >
                    <SearchBar.Behaviors>
                        <toolkit:EventToCommandBehavior
                            EventName="TextChanged"
                            BindingContext="{Binding Path=BindingContext, Source={x:Reference This}, x:DataType=ContentPage}"
                            CommandParameter="{Binding SearchInput}"
                            Command="{Binding SearchCommand}" />
                    </SearchBar.Behaviors>
                </SearchBar>
            </StackLayout>
            <CollectionView Grid.Row="2" x:Name="SearchResults"
                            SelectionChangedCommand="{Binding SelectionChangedCommand}"
                            SelectedItem="{Binding SearchSelection}"
                            ItemsSource="{Binding SearchResults}"
                            SelectionMode="Single">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout Style="{StaticResource SelectionListStyle}" Orientation="Horizontal">
                            <Image Source="{Binding Type, Converter={StaticResource SelectionImageConverter}, ConverterParameter={StaticResource SelectionImageMapper}}" HeightRequest="32"></Image>
                            <Label
                                FontSize="22"
                                Padding="5,5"
                                VerticalTextAlignment="Center"
                                Text="{Binding .}"
                                TextColor="blue">
                            </Label>
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <Label Text="No search results..."/>
                </CollectionView.EmptyView>
            </CollectionView>
            <shared:NavigationButtonsView Grid.Row="3" BackCommand="{Binding BackCommand}" NextCommand="{Binding SelectedCommand}"/>
        </Grid>
    </ContentPage.Content>
</shared:StepContentPage>